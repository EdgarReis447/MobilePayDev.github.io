"use strict";(self.webpackChunkmobile_pay_merchant_payments_documentation=self.webpackChunkmobile_pay_merchant_payments_documentation||[]).push([[2714],{3905:function(e,t,n){n.d(t,{Zo:function(){return u},kt:function(){return h}});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),c=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=c(e.components);return a.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},p=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),p=c(n),h=r,m=p["".concat(s,".").concat(h)]||p[h]||d[h]||o;return n?a.createElement(m,i(i({ref:t},u),{},{components:n})):a.createElement(m,i({ref:t},u))}));function h(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=p;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:r,i[1]=l;for(var c=2;c<o;c++)i[c]=n[c];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}p.displayName="MDXCreateElement"},99721:function(e,t,n){n.r(t),n.d(t,{assets:function(){return u},contentTitle:function(){return s},default:function(){return h},frontMatter:function(){return l},metadata:function(){return c},toc:function(){return d}});var a=n(87462),r=n(63366),o=(n(67294),n(3905)),i=["components"],l={},s="Strong Customer Authentication",c={unversionedId:"online/sca",id:"online/sca",title:"Strong Customer Authentication",description:'We aim to ensure Delegated Authentication (DA). This means that responsibility for authenticating the customer/payer no longer lies with the Issuer, but is delegated to MobilePay.  When/if we fail, and the Issuer is responding to an authorisation attempt with a Soft Decline/"step-up", a 3-D Secure fallback solution must be in place.',source:"@site/docs/online/sca.md",sourceDirName:"online",slug:"/online/sca",permalink:"/MobilePay-Payments-API/docs/online/sca",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"onlineSidebar",previous:{title:"Request Fishing Scenario",permalink:"/MobilePay-Payments-API/docs/online/basics/request-fishing"},next:{title:"Features",permalink:"/MobilePay-Payments-API/docs/category/features"}},u={},d=[{value:"Delegated authentication for Dankort",id:"delegated-authentication-for-dankort",level:2},{value:"Delegated authentication using tokens",id:"delegated-authentication-using-tokens",level:2},{value:"Delegated Authentication for Visa card",id:"delegated-authentication-for-visa-card",level:3},{value:"Delegated Authentication for Mastercard",id:"delegated-authentication-for-mastercard",level:3},{value:"3DSecure Fallback",id:"3dsecure-fallback",level:2}],p={toc:d};function h(e){var t=e.components,l=(0,r.Z)(e,i);return(0,o.kt)("wrapper",(0,a.Z)({},p,l,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"strong-customer-authentication"},"Strong Customer Authentication"),(0,o.kt)("p",null,'We aim to ensure Delegated Authentication (DA). This means that responsibility for authenticating the customer/payer no longer lies with the Issuer, but is delegated to MobilePay.  When/if we fail, and the Issuer is responding to an authorisation attempt with a Soft Decline/"step-up", a 3-D Secure fallback solution must be in place.'),(0,o.kt)("p",null,"All of the SCA implementations are mandatory. Only Dankort can be skipped if you do not accept Dankort."),(0,o.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"Note")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"Delegated Authentication can only be effectuated by the Issuer if the authorisation is based on a token. If you for some reason receive a PAN-based transaction from us, you should handle data in the card data callback as non-authenticated PAN-transactions according to scheme rules to ensure correct handling regarding SCA. If in doubt, please contact your acquirer."))),(0,o.kt)("h2",{id:"delegated-authentication-for-dankort"},"Delegated authentication for Dankort"),(0,o.kt)("p",null,"As long as you use the tags and values described here, all is well. Nets will recognize MobilePay and trust our authentication process."),(0,o.kt)("p",null,"Use POS code: \u2018K005K0K00130\u2019."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Using Nets SDI specification")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"In Field S120 tag 36: the value of 8844101001"),(0,o.kt)("li",{parentName:"ul"},"In Field S120 tag 70 pos 14 (exemption Tag): the value of 3 for Delegated Authentication")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Using Nets TRG PSIP/ ISO 8583 / Merchant Guide SSL")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"In Field 47 tag 7R: the value of 8844101001"),(0,o.kt)("li",{parentName:"ul"},"In Field 47 tag V!: the value of 23")),(0,o.kt)("h2",{id:"delegated-authentication-using-tokens"},"Delegated authentication using tokens"),(0,o.kt)("p",null,"Both Visa Token Service (VTS) and Mastercard S4C (MS4C) are based on the EMVCo standard. Please pass the data to the Acquirer, as you would do if the token response was from your own VTS or MS4C integration. In case you have questions to the Acquirer API, please ask the Acquirer.\nWhen you get the token callback, if you internally (without calling anyone) know, that token will not work for this payment, please reply HTTP code 501, we will then immediately fail over to encrypted card data callback."),(0,o.kt)("p",null,"When you initiate a payment, make sure to use v3 of the API. Here you give a tokenCallbackUrl for all accepted Visa and Mastercard types. However, please also provide a carddataCallbackUrl as failover, because not all cards can be tokenized. For Dynamic Linking, please give us MerchantUrl and MerchantName."),(0,o.kt)("p",null,"When you recieve the token callback, you\xb4ll find a cardIssuedInCountryCode (possible values DK, FI) you can use for your Acquirer routing logic."),(0,o.kt)("p",null,'Exactly as for encrypted card data callbacks, make sure you respond to the callback immediately. DO NOT leave the transaction "hanging" while you call out to the Acquirer. If we do not get a response to the callback in proper time we will allow the user to accept the payment again.'),(0,o.kt)("p",null,(0,o.kt)("a",{target:"_blank",href:n(34103).Z},(0,o.kt)("img",{alt:"Token",src:n(27227).Z,width:"1587",height:"1123"}))),(0,o.kt)("h3",{id:"delegated-authentication-for-visa-card"},"Delegated Authentication for Visa card"),(0,o.kt)("p",null,"A Visa Token Service (VTS) response like this:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json",metastring:'title="VTS token callback example"',title:'"VTS',token:!0,callback:!0,'example"':!0},'{\n"paymentId": "string",\n"authorizationAttemptId": "string",\n"cardType": "string",\n"cardIssuedInCountryCode": "string",\n"maskedCardNumber":"string",\n"tokenMethod": "string",\n"tokenData": {\n  "vPaymentDataID": "string",\n    "cryptogramInfo": {\n     "cryptogram": "string",\n     "eci": "string"\n    },\n    "paymentInstrument": {\n     "last4": "string",\n     "paymentType": {\n      "cardBrand": "string"\n     },\n     "paymentAccountReference": "string"\n    },\n    "tokenInfo": {\n     "token": "string",\n     "last4": "string",\n     "expirationDate": {\n      "month": "string",\n      "year": "string"\n     }\n    },\n   },\n   "isDelegatedAuthentication": bool\n}\n')),(0,o.kt)("p",null,"Example:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json",metastring:'title="VTS token callback example"',title:'"VTS',token:!0,callback:!0,'example"':!0},'{\n   "paymentId":"8dab9219-ab03-4524-bae7-f0ad55119da5",\n   "authorizationAttemptId":"32eedb2b-a536-4eb6-b618-c2d6c1bf7aab",\n   "cardType":"VISA-CREDIT",\n   "cardIssuedInCountryCode":"DK",\n   "maskedCardNumber":"479694XXXXXX1234",\n   "tokenMethod":"VTS",\n   "tokenData":{\n      "vPaymentDataID":"da17bd1568bdc8b418d71cf80c44ea02",\n      "cryptogramInfo":{\n         "cryptogram":"/wAAAAwAUkMTObMAAAAAgS0AAAA=",\n         "eci":"07"\n      },\n      "paymentInstrument":{\n         "last4":"1234",\n         "paymentType":{\n            "cardBrand":"VISA"\n         },\n         "paymentAccountReference":"V0010013020217426481676671969"\n      },\n      "tokenInfo":{\n         "token":"4895737462013403",\n         "last4":"3403",\n         "expirationDate":{\n            "month":"02",\n            "year":"2023"\n         }\n      }\n   },\n   "isDelegatedAuthentication": false\n}\n')),(0,o.kt)("h3",{id:"delegated-authentication-for-mastercard"},"Delegated Authentication for Mastercard"),(0,o.kt)("p",null,"A Mastercard S4C (MS4C) response like this:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json",metastring:'title="MS4C token callback example"',title:'"MS4C',token:!0,callback:!0,'example"':!0},'{\n   "paymentId":"1ba21790-5e10-4db1-8e90-330fb41916e7",\n   "authorizationAttemptId":"3205ec7c-2d50-49d2-95dc-326e34edce47",\n   "cardType":"MC-CREDIT",\n   "cardIssuedInCountryCode":"DK",\n   "maskedCardNumber":"520473XXXXXX4792",\n   "tokenMethod":"MC S4C",\n   "tokenData":{\n      "token":{\n         "paymentToken":"5204731613942625",\n         "tokenExpirationMonth":"05",\n         "tokenExpirationYear":"2024",\n         "paymentAccountReference":"5001BO8B9NXVVIXCT0HAJU98I512Z"\n      },\n      "dynamicData":{\n         "dynamicDataType":"CARD_APPLICATION_CRYPTOGRAM_SHORT_FORM",\n         "dynamicDataValue":"MD1eEaqbngDNAy0iuRqOAAADFEA="\n      },\n      "eci":"06"\n   }\n}\n')),(0,o.kt)("h2",{id:"3dsecure-fallback"},"3DSecure Fallback"),(0,o.kt)("p",null,"If Delegated Authentication fails, the 3DSecure fallback solution applies."),(0,o.kt)("p",null,(0,o.kt)("a",{target:"_blank",href:n(40262).Z},(0,o.kt)("img",{alt:"3DS fallback",src:n(43024).Z,width:"1587",height:"1123"}))),(0,o.kt)("p",null,"When the user has completed the challenge, please immediately redirect to ",(0,o.kt)("a",{parentName:"p",href:"https://products.mobilepay.dk/remote-website/apppages/done3ds.html"},"https://products.mobilepay.dk/remote-website/apppages/done3ds.html"),"\nFor Sandbox use: ",(0,o.kt)("a",{parentName:"p",href:"https://sandprod-products.mobilepay.dk/remote-website/apppages/done3ds.html"},"https://sandprod-products.mobilepay.dk/remote-website/apppages/done3ds.html")),(0,o.kt)("p",null,"If the user cancels the 3DS challenge on the 3DS website or if it fails in some way, you should fail the authorization attempt with reasonCode=1000 and redirect to the done3ds.html page. This will cancel the 3DS flow in the MobilePay app and allow the user to retry with another card (starting a new authorization attempt)."),(0,o.kt)("p",null,"Optional: As soon as you have 3DS crypto from ACS and before retrying the authorization-attempt towards Acquirer and Issuer, you can call the MP backend with reasonCode=1009. This enables us to prevent the user from retrying with another card."))}h.isMDXComponent=!0},40262:function(e,t,n){t.Z=n.p+"assets/files/3dsfallback-fd3ce21fd379ed6ead89f1c27893269b.svg"},34103:function(e,t,n){t.Z=n.p+"assets/files/token-80be12f91bc084a26edd190c39810a9c.svg"},43024:function(e,t,n){t.Z=n.p+"assets/images/3dsfallback-fd3ce21fd379ed6ead89f1c27893269b.svg"},27227:function(e,t,n){t.Z=n.p+"assets/images/token-80be12f91bc084a26edd190c39810a9c.svg"}}]);